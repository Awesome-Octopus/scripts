% selected_positions is a matrix containing the xyz vector in each
    % cell of the BB and SC of each site pair in each frame indexed as
    % follows: selected_positions (site pair#, site, frame#, dimension) where site
    % number is 1-4 with 1 = BB site 1, 2 = BB site 2, 3 = SC site 1, 4 =
    % SC site 4. and dimension is 1-3 with 1 = x, 2 = y, 3 = z.


    selected_positions = zeros(n_sitepairs, 4, numframes, 3);
    
    for i=1:n_sitepairs
        
        
    % for every xyz vector (1 per frame in a 1 by n cell array)
    % at the coordinate with index given by the above function
    % take the corresponding vector in the same frame for the coordinate
    % given by the second index then find the distance at that frame
    % repeat over all frames to create a vector of distances

        for s = 1:4
            
            % for some sites, the indices function might not have
            % been able to find an index with matching tags, in which case it
            % would be zero at that position
            
            ndx = indices(i,s);
            if ndx ~= 0
                for v = 1:numframes
                    
                    % the x coordinate
                    selected_positions(i,s,v,1) = coordinate(ndx).xyz{v}(1);
                    % the y coordinate
                    selected_positions(i,s,v,2) = coordinate(ndx).xyz{v}(2);
                    % the z coordinate
                    selected_positions(i,s,v,3) = coordinate(ndx).xyz{v}(3);
                end
            else
                selected_positions(n_sitepairs,s,:,:) = NaN;
                
                if s > 2
                % let the user know there is no beta carbon
                    message = sprintf('One or more residue selections do not have a sidechain or beta carbon coordinate to use.\nThis may be because the selected residue is a glycine.\nThe label coordinates for this site will be extrapolated from the backbone or alpha carbon coordinates instead');
                    uialert(fig, message, 'Notice','Icon','warning');
                else % if the backbone coordinate can't be found 
                    message = sprintf('One or more residue selections do not have a backbone coordinate.\nThe distance for this pair can not be calculated');
                    uialert(fig, message, 'Error','Icon','error');
                end
            end    
        end
    end
    fig.UserData = selected_positions;