function tm = t1test();
[b spec params] = eprload();
[b] = real(b);
[spec] = real(spec);
[shift ns] = strread(params.FTEzDelay1,'%f %s');
[shift2 ns2] = strread(params.FTEzDelay2,'%f %s');
name = params.TITL;
name = sprintf('%s.DTA',name);
b = b + shift*2+shift2;
b = b';
spec = spec';

function f = t1decay(x);
spec = spec';
[xsim] = linspace(min(b),max(b),params.XPTS);
f = sum(abs(spec-(x(1)*(1-2*exp((-xsim/x(2)))))))/params.XPTS;

[x,fval] = fminsearch(@t1decay,[-min(spec),max(b)/4],[],name);

xfit = linspace(min(b),max(b),params.XPTS);
yfit = x(1)*(1-2*exp((-xfit/x(2))));
xrounda = round(x(2));
tmlabela = sprintf('T1 = %i ns',xrounda);
plot(b,spec,xfit,yfit);
axis tight;
xlabel('time(ns))','FontSize',18), ylabel('intensity','FontSize',18);
title('T1 Determination','FontSize',20);
text(x(2)+100,max(spec)*0.8,tmlabela,'FontSize',18);
line([x(2);x(2)],[0;max(spec)],'Color','r','LineWidth',2);